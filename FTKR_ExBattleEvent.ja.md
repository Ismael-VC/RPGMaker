[トップページに戻る](README.md)

# [FTKR_ExBattleEvent](FTKR_ExBattleEvent.js) プラグイン

バトルイベントを拡張するプラグインです。

ダウンロード: [FTKR_ExBattleEvent.js](https://raw.githubusercontent.com/futokoro/RPGMaker/master/FTKR_ExBattleEvent.js)

## 目次

以下の項目の順でプラグインの使い方を説明します。
1. [概要](#概要)
1. [戦闘勝利時のイベントの設定](#戦闘勝利時のイベントの設定)
1. [戦闘敗北時のイベントの設定](#戦闘敗北時のイベントの設定)
1. [プラグインコマンド](#プラグインコマンド)
* [プラグインの更新履歴](#プラグインの更新履歴)
* [ライセンス](#ライセンス)

## 概要

本プラグインを実装することで、バトルイベントを拡張します。

１．通常の戦闘勝利時の処理(*1)の替わりに、コモンイベントまたは敵グループに設定したイベントを実行します。

２．通常の戦闘敗北時の処理(*1)の替わりに、コモンイベントまたは敵グループに設定したイベントを実行します。

(*1)戦闘終了時のステートの解除から、勝利等のメッセージ、戦闘報酬の処理など

イベントの処理が終了すると、バトル画面が終了します。

![画像](image/FTKR_ExBattleEvent/n01_001.png)

[目次に戻る](#目次)

## 戦闘勝利時のイベントの設定

通常の戦闘勝利時の処理の替わりに、コモンイベントまたは敵グループに設定したイベントを実行します。
実行するイベントは以下のいずれかです。

１．プラグインパラメータ`<Victory Event>`に設定したIDのコモンイベント<br>
２．敵グループのバトルイベントで、注釈で`<EBE_戦闘勝利時>`と記入したページ

１と２どちらもある場合は、バトルイベントを実行します。

バトルイベント内では、`this._eventId` で敵グループIdを取得できます。

### 戦闘勝利時の処理について

通常、戦闘勝利時には以下の処理を実行しています。
当プラグインによって戦闘勝利イベントを差し替えた場合、これらの処理が必要な場合はイベント内で実行しなくてはいけません。

１．戦闘終了時のステート解除

パーティー内に、戦闘終了時に解除されるステートを受けている場合にそれを解除します。

プラグインコマンド
```
EBE_戦闘終了時ステート解除
EBE_REMOVE_BATTLE_STATES
```

２．勝利モーションの実行

パーティーメンバーが、戦闘勝利モーションを実行します。

プラグインコマンド
```
EBE_勝利モーション実行
EBE_PREFORM_VICTORY
```

３．勝利MEの演奏

データベースの[システム]-[音楽]で設定した勝利MEを演奏します。

プラグインコマンド
```
EBE_勝利ME演奏
EBE_PLAY_VICTORY_ME
```

４．BGMBGSの再開

戦闘前のBGMとBGSを再開します。

プラグインコマンド
```
EBE_BGMBGS再開
EBE_REPLAY_BGM_AND_BGS
```

５．戦闘報酬の計算

経験値やお金、アイテムの計算を行います。
入手するアイテムはこのコマンドで選定されます。

プラグインコマンド
```
EBE_戦闘報酬計算
EBE_MAKE_REWARDS
```

６．勝利メッセージの表示

データベースの[用語]-[メッセージ]で設定した勝利メッセージを表示します。

プラグインコマンド
```
EBE_勝利メッセージ表示
EBE_DISPLAY_VICTORY_MESSAGE
```

７．戦闘報酬の表示

戦闘報酬の計算結果に合わせて、データベースの[用語]-[メッセージ]で設定したメッセージを表示します。

プラグインコマンド
```
EBE_戦闘報酬表示
EBE_DISPLAY_REWARDS
```
　
８．戦闘報酬の入手

戦闘報酬の計算結果をパーティーメンバーに反映します。
このコマンドを実行しないと、経験値やお金アイテムは実際に入手できません。

プラグインコマンド
```
EBE_戦闘報酬入手
EBE_GAIN_REWARDS
```

[目次に戻る](#目次)

## 戦闘敗北時のイベントの設定

通常の戦闘敗北時の処理の替わりに、コモンイベントまたは敵グループに設定したイベントを実行します。
実行するイベントは以下のいずれかです。

１．プラグインパラメータ`<Defeat Event>`に設定したIDのコモンイベント<br>
２．敵グループのバトルイベントで、注釈で`<EBE_戦闘敗北時>`と記入したページ

１と２どちらもある場合は、バトルイベントを実行します。

バトルイベント内では、`this._eventId` で敵グループIdを取得できます。

### 戦闘敗北時の処理について

通常、戦闘敗北時には以下の処理を実行しています。
当プラグインによって戦闘敗北イベントを差し替えた場合、これらの処理が必要な場合はイベント内で実行しなくてはいけません。

１．敗北メッセージの表示

データベースの[用語]-[メッセージ]で設定した敗北メッセージを表示します。

プラグインコマンド
```
EBE_敗北メッセージ表示
EBE_DISPLAY_DEFEAT_MESSAGE
```

２．敗北MEの演奏

データベースの[システム]-[音楽]で設定した敗北MEを演奏します。

プラグインコマンド
```
EBE_敗北ME演奏
EBE_PLAY_DEFEAT_ME
```

３．BGMBGSの再開　または　BGMの停止

戦闘前のBGMとBGSを再開するか、またはBGMを停止します。
マップイベントで戦闘の敗北を許可しているかどうかで条件分岐します。

戦闘の敗北フラグ
```
BattleManager._canLose
```

BGMBGSの再開のプラグインコマンド
```
EBE_BGMBGS再開
EBE_REPLAY_BGM_AND_BGS
```

BGMの停止のプラグインコマンド
```
EBE_BGM停止
EBE_STOP_BGM
```

[目次に戻る](#目次)

## プラグインコマンド

バトルイベント用に以下のプラグインコマンドが使用できます。

### パーティーメンバーに指定のモーションをとらせる
```
EBE_モーション実行 [モーション名]
EBE_REQUEST_MOTION [MOTION NAME]
```
モーション名(MOTION NAME)には以下を入力してください。(要小文字)
```
walk, wait, chant, guard, damage, evade, thrust, swing,
missile, skill, spell, item, escape, victory, dying,
abnormal, sleep, dead,
```


### 戦闘を再開する
```
EBE_戦闘再開
EBE_RESTART_BATTLE
```
勝利イベントや敗北イベントはイベント終了時にバトルが終了しますがこのコマンドを実行することで、バトルを再開します。
ただし、エネミーが何もいない場合や、アクターが全員戦闘不能な場合はバトルを再開しても、すぐに勝利イベントや敗北イベントを再度実行します。

このコマンドがイベント中常に実行する場合はバトルが終わりません。
バトルを終わらせる時に、条件分岐等で再開コマンドを実行しないようにイベントを組んでください。

[目次に戻る](#目次)

## プラグインの更新履歴

| バージョン | 公開日 | 更新内容 |
| --- | --- | --- |
| [ver1.0.0](FTKR_ExBattleEvent.js) | 2017/05/25 | 初版公開 |

## 拡張プラグイン

以下のプラグインを使用することで、本プラグインの機能を拡張できます。

* [FTKR_SetupTroops.js](FTKR_SetupTroops.ja.md) - バトル中に敵グループに設定していないエネミーを追加できます。

## ライセンス

本プラグインはMITライセンスのもとで公開しています。

[The MIT License (MIT)](https://opensource.org/licenses/mit-license.php)

#
[目次に戻る](#目次)

[トップページに戻る](README.md)