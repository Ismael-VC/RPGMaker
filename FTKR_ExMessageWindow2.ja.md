[トップページに戻る](README.ja.md)

# [FTKR_ExMessageWindow2](FTKR_ExMessageWindow2.js) プラグイン

一度に複数のメッセージウィンドウを表示するプラグインです。
本プラグインは、FTKR_ExMessageWindow.jsと組み合わせて使用できません。

ダウンロード: [FTKR_ExMessageWindow2.js](https://raw.githubusercontent.com/futokoro/RPGMaker/master/FTKR_ExMessageWindow2.js)

## 目次

以下の項目の順でプラグインの使い方を説明します。
1. [概要](#概要)
1. [プラグインの登録](#プラグインの登録)
2. [基本仕様](#基本仕様)
    1. [拡張メッセージウィンドウ](#拡張メッセージウィンドウ)
    1. [メッセージウィンドウID](#メッセージウィンドウID)
3. [拡張メッセージウィンドウを使用した文章の表示](#拡張メッセージウィンドウを使用した文章の表示)
    1. [基本の表示方法](#基本の表示方法)
    1. [複数ウィンドウの表示方法](#複数ウィンドウの表示方法)
4. [文章表示中にプレイヤーの行動を許可する](#文章表示中にプレイヤーの行動を許可する)
    1. [基本的な使い方](#基本的な使い方)
    1. [文章表示中のイベントに話しかけたい場合](#文章表示中のイベントに話しかけたい場合)
7. [スクリプトコマンド](#スクリプトコマンド)
8. [プラグインコマンド](#プラグインコマンド)
* [プラグインの更新履歴](#プラグインの更新履歴)
* [類似プラグイン](#類似プラグイン)
* [ライセンス](#ライセンス)

## 概要

このプラグインを使用することで、文章の表示イベントで以下の動作が可能になります。

1. 複数のメッセージウィンドウを画面に表示できます。
2. メッセージ表示中にプレイヤーの行動を許可できます。
3. 表示中のメッセージウィンドウを強制終了させることができます。

[目次に戻る](#目次)

## プラグインの登録

以下のプラグインと組み合わせて使用する場合は、プラグイン管理画面で、以下の順の配置になるように登録してください。
```
YEP_MessageCore.js
FTKR_ExMessageWindow2.js
MessageWindowPopup.js
```

[目次に戻る](#目次)

## 基本仕様

### 拡張メッセージウィンドウ

本プラグインを有効にすると、イベントコマンド「文章の表示」に使用するウィンドウに、MVデフォルトのメッセージウィンドウとは別のメッセージウィンドウを使用します。

これを、本プラグインでは拡張メッセージウィンドウと呼びます。

### メッセージウィンドウID

拡張メッセージウィンドウは、それぞれ個別のメッセージウィンドウID(ウィンドウID)を持っています。
このIDを変えることで、一度に複数のウィンドウを表示させることができます。

メッセージウィンドウIDは、プラグインのデフォルトで ID0 を使用します。

#### 拡張メッセージウィンドウの数
プラグインパラメータ`<Create ExWindow Number>`の設定でウィンドウIDを何番まで使用できるか決まります。
<設定値: 2> なら、ID0 ~ ID2 まで使用できます。

<設定値: 0> の場合は、マップ上のイベントの数のIDを使用できます。
また、自動的に文章を表示するイベントのIDと同じIDのメッセージウィンドウを使用します。

#### ウィンドウIDの注意点
本プラグインは、ウィンドウIDの数だけウィンドウデータを生成します。
ウィンドウIDの数が多すぎる場合、その分処理が重くなる可能性があります。

[目次に戻る](#目次)

## 拡張メッセージウィンドウを使用した文章の表示

### 基本の表示方法
以下にイベント例を示します。

```
◆プラグインコマンド：EMW_メッセージウィンドウ指定 1
◆文章：なし, ウィンドウ, 下
：　　：これがメッセージウィンドウIDを指定する方法だ
```

プラグインコマンド「EMW_メッセージウィンドウ指定 x」を使うことで
表示させるウィンドウIDを指定します。
このように、文章イベントの実行前にプラグインコマンドで設定します。

ウィンドウIDを変えない場合は、下のように文章イベントを続けることができます。
```
◆プラグインコマンド：EMW_メッセージウィンドウ指定 1
◆文章：なし, ウィンドウ, 下
：　　：これがメッセージウィンドウIDを指定する方法だ
◆文章：なし, ウィンドウ, 下
：　　：この文章もメッセージウィンドウID1に表示するぞ
```

### 複数ウィンドウの表示方法

メッセージウィンドウIDを使うことで、複数のウィンドウを表示させることができます。

#### ウィンドウを閉じさせない方法
通常、メッセージウィンドウは表示が終わりキー入力後にウィンドウが閉じます。
拡張メッセージウィンドウも基本的には変わりません。

本プラグインでは、以下のプラグインコマンドを使用すると、ウィンドウを閉じなくすることができます。

```
◆プラグインコマンド：EMW_メッセージウィンドウ指定 1 終了禁止
◆文章：なし, ウィンドウ, 下
：　　：こうするとメッセージウィンドウID1は閉じないぞ
```

ただし、このままではイベントが終わってもウィンドウが表示したままになります。
そのため、以下のいずれかの方法でウィンドウを閉じる必要があります。

#### 強制終了コマンドで閉じる
プラグインコマンド「EMW_メッセージウィンドウ強制終了 x」を使うことでウィンドウID x を閉じます。
```
◆プラグインコマンド：EMW_メッセージウィンドウ指定 1 終了禁止
◆文章：なし, ウィンドウ, 下
：　　：こうするとメッセージウィンドウID1は閉じるぞ
◆プラグインコマンド：EMW_メッセージウィンドウ強制終了 1
```

#### 終了許可設定にした新たに文章表示イベントを実行する
プラグインコマンド「EMW_メッセージウィンドウ設定 x 終了許可」を使うことでウィンドウID x が閉じるようになります。

```
◆プラグインコマンド：EMW_メッセージウィンドウ指定 1 終了禁止
◆文章：なし, ウィンドウ, 下
：　　：こうするとメッセージウィンドウID1は閉じないぞ
◆プラグインコマンド：EMW_メッセージウィンドウ指定 1 終了許可
◆文章：なし, ウィンドウ, 下
：　　：こうするとメッセージウィンドウID1は閉じるぞ
```
この場合、一つ目の文章ではウィンドウは閉じませんが、二つめの文章イベントでは、キー入力後にウィンドウが閉じます。
必ず、終了許可後に文章イベントを実行してください。

### 複数ウィンドウを表示するイベントの組み方

「複数のウィンドウIDの指定」と「ウィンドウを閉じさせない方法」を使うことで、複数のウィンドウを画面に表示することができます。

以下は画面の上下で会話するイベント例です。
```
◆プラグインコマンド：EMW_メッセージウィンドウ指定 1 終了禁止
◆文章：なし, ウィンドウ, 下
：　　：こうするとメッセージウィンドウID1は閉じないぞ
◆プラグインコマンド：EMW_メッセージウィンドウ指定 2 終了禁止
◆文章：なし, ウィンドウ, 上
：　　：確かにメッセージウィンドウID2も閉じないな
◆プラグインコマンド：EMW_メッセージウィンドウ指定 1
◆文章：なし, ウィンドウ, 下
：　　：これはいいな
◆プラグインコマンド：EMW_メッセージウィンドウ指定 2
◆文章：なし, ウィンドウ, 上
：　　：そうだな
◆プラグインコマンド：EMW_メッセージウィンドウ強制終了 すべて
```

下に表示するウィンドウをウィンドウID1に、上に表示するウィンドウをウィンドウID2 に設定します。
また、両方のウィンドウIDを終了禁止にします。

こうすることで、以降の文章イベントでウィンドウが表示したまま表示内容が更新できます。

そして、最後のコマンドによって表示しているウィンドウID1とID2を閉じます。

このような流れで、メッセージウィンドウを複数表示することができます。
あとは、3番目の文章と4番目の文章のように、ウィンドウ指定コマンドと文章を
追加していくことで、長い会話イベントを作成することができます。

[目次に戻る](#目次)

## 文章表示中にプレイヤーの行動を許可する

以下の制御文字を文章中に入力することで、メッセージ表示中の
プレイヤーの行動可否を設定できます。

```
\EMP - 行動を許可
\DMP - 行動を禁止
```

### 基本的な使い方

イベントの文章表示中にプレイヤーの行動を許可した場合
別のイベントと会話イベントを起こすことが可能です。

この場合、文章表示中のメッセージウィンドウIDとは別のウィンドウIDに表示させる必要があります。

文章表示のイベントコマンドの前に、ウィンドウIDを指定するコマンドを実行してください。

なお、プラグインパラメータ`<Create ExWindow Number>`を 0 に設定した場合はウィンドウIDを指定する必要はありません。
自動的にイベントIDと同じ番号のウィンドウIDを使用します。

### 文章表示中のイベントに話しかけたい場合

文章を表示しているイベントに話しかけたい場合は、以下のイベントの作成方法が
あります。

#### 自動で表示させる文章表示イベントの作成
「自律移動」のタイプ「カスタム」のルート設定内に、以下のスクリプトを入力することで文章を表示させます。

スクリプト
```
$gameMessageEx.window(1).add('\\EMP文章\\|\\^')
```

window(1) は 文章を表示させるウィンドウID の番号を指定します。
ここでは、例としてID1 を使用します。

add()内には、表示する文章を入力します。
使用している制御文字の意味は以下の通りです。
* `\\EMP` - プレイヤーの行動を許可
* `\\|`   - ウィンドウを1秒表示
* `\\^`   - プレイヤーの入力待ちを不要

#### 話しかけて表示させる文章表示イベントの作成
上記と同じページの実行内容に以下のイベントを作成します。
トリガーは「決定ボタン」です。

実行内容
```
◆プラグインコマンド：EMW_メッセージウィンドウ強制終了 1
◆プラグインコマンド：EMW_メッセージウィンドウ指定 2
◆文章：なし, ウィンドウ, 下
：　　：話しかけるな！
```

1行目のコマンドで、自動表示しているウィンドウを消します。
この時に指定する番号は、スクリプト内で使用したウィンドウIDと合わせてください。

2行目に別のウィンドウIDを指定して、3行目で文章を表示します。
会話で表示するウィンドウIDを別にする理由は、強制終了の処理が終わる前に文章表示コマンドの読み込みが始まり、同じIDだと閉じて表示できないためです。

[目次に戻る](#目次)

## スクリプト

拡張メッセージウィンドウのゲームデータは以下のスクリプトで参照できます。
```
$gameMessageEx.window(ウィンドウID)
```

拡張メッセージウィンドウのゲームデータに使用できる関数や変数はMVデフォルトのメッセージウィンドウ($gameMessage)と同じです。

以下に、スクリプトの一例を示します。

### 文章を表示
```
$gameMessageEx.window(ウィンドウID).add('文章')
```
'文章'には制御文字が使用できますが、`\\v[1]`の用に`\`記号を2つ使う必要があるので注意です。

### 顔画像の設定
```
$gameMessageEx.window(ウィンドウID).setFaceImage('顔画像名', 顔番号)
```
* 顔画像名 - 表示する顔画像のファイル名です。(例:'Actor1')
* 顔番号　 - ファイル内の何番目の顔かを指定する番号です。左上が 0番です。

### 背景の設定
```
$gameMessageEx.window(ウィンドウID).setBackground(背景番号)
```
* 背景番号 - 表示したい背景タイプの番号を指定してください。
    * 0 - ウィンドウ
    * 1 - 暗くする
    * 2 - 透明

### 表示位置の設定
```
$gameMessageEx.window(ウィンドウID).setPositionType(位置番号)
```
* 位置番号 - 表示したい位置の番号を指定してください。
    * 0 - 上
    * 1 - 中
    * 2 - 下

### 表示内容の初期化
```
$gameMessageEx.window(ウィンドウID).clear()
```
表示する文章や顔画像等の設定内容を初期化します。

[目次に戻る](#目次)

## プラグインコマンド

### 文章の表示の強制終了
```
EMW_メッセージウィンドウ強制終了 すべて
EMW_MESSAGEWINDOW_CLOSE ALL
EMW_メッセージウィンドウ強制終了 Id
EMW_MESSAGEWINDOW_CLOSE Id
```
表示されているメッセージウィンドウを強制的に閉じます。
* すべて - 表示しているすべてのウィンドウIDを強制的に閉じます。
* Id　　 - 指定したウィンドウのIDを強制的に閉じます。指定しない場合は、ウィンドウID0 を閉じます。

### 文章を表示するウィンドウを指定
```
EMW_メッセージウィンドウ指定 Id (終了禁止/終了許可)
EMW_MESSAGEWINDOW_SET Id (NOEND/CANCLOSE)
```
このコマンド以降に文章を表示する場合に使用する拡張ウィンドウのメッセージウィンドウIDを指定します。

'終了禁止' または '終了許可' をつけるとIDの指定と合わせて、ウィンドウの開閉設定ができます。

例)
```
EMW_メッセージウィンドウ指定 1
EMW_メッセージウィンドウ指定 2 終了禁止
```

### 文章を表示するウィンドウの指定をリセット
```
EMW_メッセージウィンドウリセット
EMW_MESSAGEWINDOW_RESET
```
このコマンド以降に文章を表示する場合に使用する拡張ウィンドウのメッセージウィンドウIDをリセットします。(ID0 になる)

### メッセージウィンドウの終了禁止(ウィンドウが閉じない)
```
EMW_メッセージウィンドウ終了禁止 Id
EMW_MESSAGEWINDOW_NOEND Id
```
指定したIDのウィンドウはメッセージ表示後に閉じなくなります。
禁止設定にしたウィンドウを閉じるためには以下の動作が必要です。
* a. 強制終了コマンドで閉じる
* b. 終了許可設定にした上で、新たにメッセージを表示させる。

### メッセージウィンドウの終了許可(ウィンドウが閉じる)
```
EMW_メッセージウィンドウ終了許可 Id
EMW_MESSAGEWINDOW_CANCLOSE Id
```
指定したIDのウィンドウはメッセージ表示後に閉じるようになります。

[目次に戻る](#目次)

## プラグインの更新履歴

| バージョン | 公開日 | 更新内容 |
| --- | --- | --- |
| [ver2.0.2](#FTKR_ExMessageWindow2.js) | 2017/05/01 | プラグインコマンドにおける不具合修正 |
| ver2.0.1 | 2017/05/01 | 強制終了コマンドに表示中の全ウィンドウIDを指定する機能を追加 |
| ver2.0.0 | 2017/04/24 | 初版公開 |

## ライセンス

本プラグインはMITライセンスのもとで公開しています。

[The MIT License (MIT)](https://opensource.org/licenses/mit-license.php)

#
[目次に戻る](#目次)

[トップページに戻る](README.ja.md)